{"version":3,"sources":["src/engine/mongo.js"],"names":[],"mappings":"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","file":"src/engine/mongo.js","sourcesContent":["\nimport Engine from '../engine'\nimport * as is from '../is'\nimport same from '../same'\nimport { arrize } from '../utils'\nimport * as ensure from '../ensure'\n\nconst mongo = new Engine()\nexport default mongo\n\nexport function test (json, query) {\n  return mongo.test(json, query)\n}\n\n// Comparision\n\nmongo.append('conditions', '$eq', function (a, b) { return same(a, b) } )\nmongo.append('conditions', '$gt', function (a, b) { return a > b } )\nmongo.append('conditions', '$gte', function (a, b) { return a >= b } )\nmongo.append('conditions', '$lt', function (a, b) { return a < b } )\nmongo.append('conditions', '$lte', function (a, b) { return a <= b } )\nmongo.append('conditions', '$ne', function (a, b) { return !same(a, b) } )\n\nmongo.append('conditions', '$in', function (a, b) {\n  let a_ = arrize(a)\n  return arrize(b).some(function (e) {\n    return a_.indexOf(e) >= 0\n  })\n})\n\nmongo.append('conditions', '$nin', function (a, b) {\n  let aa = arrize(a)\n  return arrize(b).every(function (e) {\n    return aa.indexOf(e) < 0\n  })\n})\n\n// Logical\n\nmongo.append('conditions', '$or', function (a, b) {\n  ensure.array(b)\n  return b.reduce(((p, c) => p || this.test(a, c)), false)\n})\n\nmongo.append('conditions', '$and', function (a, b) {\n  ensure.array(b)\n  return b.reduce(((p, c) => p && this.test(a, c)), true)\n})\n\nmongo.append('conditions', '$not', function (a, b) {\n  return !this.test(a, b)\n})\n\nmongo.append('conditions', '$nor', function (a, b) {\n  ensure.array(b)\n  return b.reduce(((p, c) => p && !this.test(a, c)), true)\n})\n\n// Element\n\nmongo.append('conditions', '$exists', function (a, b) {\n  return !((!!b) ^ !is.none(a))\n})\n\nmongo.append('conditions', '$type', function (a, b) {\n  return typeof(a) === b\n})\n\n// Evaluation\n\nmongo.append('conditions', '$mod', function (a, b) {\n  return (a % b[0]) === b[1]\n})\n\nmongo.append('conditions', '$regex', function (a, b, c) {\n  return !!a.match(new RegExp(b, c.$options))\n})\n\n// HACK: $options referenced from $regex\nmongo.append('conditions', '$options', function () {\n  return true\n})\n\nmongo.append('conditions', '$where', function (a, b, c) {\n  // ensure.func(b)\n  return b(a)\n})\n\n// Geospatial\n\n// TODO: $geoWithin\n// TODO: $geoIntersects\n// TODO: $near\n// TODO: $nearSphere\n\n// Array\n\nmongo.append('conditions', '$all', function (a, b) {\n  return is.array(a) && is.array(b) && b.every((e) => a.indexOf(e) >= 0)\n})\n\nmongo.append('conditions', '$elemMatch', function (a, b) {\n  return is.array(a) && a.some((e) => this.test(e, b))\n})\n\nmongo.append('conditions', '$size', function (a, b) {\n  return b === (is.array(a) ? a.length : 0)\n})\n"]}